---
# ============LICENSE_START=======================================================
#  Copyright (C) 2021 Nordix Foundation.
# ================================================================================
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
# ============LICENSE_END=========================================================

- project:
    name: 'meridio-experimentation-jenkins-test'

    project: 'meridio-experimentation-jenkins-test'

    ghprb-auth-id: '6c8995d2-4242-4633-8506-df7586724885'
    stream:
      - 'main':
          branch: '${{ghprbActualCommit}}'

    image-name:
      - my-image

    jobs:
      - 'meridio-experimentation-jenkins-test-{image-name}-{stream}'

- job-template:
    name: 'meridio-experimentation-jenkins-test-{image-name}-{stream}'
    project-type: pipeline
    disabled: '{obj:disabled}'

    concurrent: true

    properties:
      - github:
          url: https://github.com/LionelJouin/jenkins-test

    parameters:
      - string:
          name: GITHUB_ORGANIZATION
          default: 'LionelJouin'
          description: JJB configured parameter to identify GitHub Organization
      - string:
          name: PROJECT
          default: 'jenkins-test'
          description: JJB configured PROJECT parameter to identify a Nordix GitHub project

    scm:
      - git:
          url: 'https://github.com/$GITHUB_ORGANIZATION/$PROJECT.git'
          branches:
            - '{branch}'
          refspec: '+refs/pull/*:refs/remotes/origin/pr/*'
          timeout: 15
          wipe-workspace: true
          choosing-strategy: 'default'
          clean_before: false

    triggers:
      - github-pull-request:
          admin-list:
            - LionelJouin
          auth-id: '{ghprb-auth-id}'
          github-hooks: true
          permit-all: true
          trigger-phrase: '/reverify'
          only-trigger-phrase: false
          cron: 'H/5 * * * *'
          status-context: 'Nordix Jenkins Image Build: {image-name}'

    # builders:
    #   - shell: |-
    #       echo "test ABC"
    #       printenv

    # dsl: |
    #   stage('Build another job') {{
    #     build(job: "Hello-World")
    #   }}

    # dsl:
    #   !include-raw-escape: Jenkinsfile.groovy

    # pipeline:
    #   script: 
    #       !include-raw: ./Jenkinsfile

    dsl: 
      !include-raw-escape: Jenkinsfile

    # dsl: |
    #   build job: "job1"
    #   parallel [
    #     2a: build job: "job2a",
    #     2b: node "dummynode" {
    #       sh "echo I'm alive!"
    #     }
    #   ]

    # pipeline:
    #   script: |
    #     # Your dsl script goes here.
    #     node {
    #       echo 'Hello world'
    #     }
    # sandbox: true

    # sandbox: true
    # pipeline-scm:
    #   scm:
    #     - hg:
    #         url: https://raw.githubusercontent.com/LionelJouin/jenkins-test/main/Jenkinsfile
    #         clean: true

